---
import Layout from '@layouts/Layout.astro';
import { getAllPosts } from '@content/posts';

export async function getStaticPaths() {
  const posts = await getAllPosts();
  const set = new Set<string>();
  posts.forEach(p => (p.tags ?? []).forEach(t => set.add(t)));
  return Array.from(set).map(tag => ({ params: { tag } }));
}

const { tag } = Astro.params;
const posts = (await getAllPosts()).filter(p => (p.tags ?? []).includes(tag!));
---

<Layout title={`#${tag}`} description={`Posts tagged ${tag}`}>
  <h1 class="text-2xl font-semibold">#{tag}</h1>
  <ul class="mt-6 space-y-4">
    {posts.map(p => (
      <li>
        <a class="text-primary hover:underline" href={`/blog/${p.slug}`}>{p.title}</a>
        {p.date && <span class="ml-2 text-sm opacity-70">{new Date(p.date).toLocaleDateString()}</span>}
      </li>
    ))}
  </ul>
</Layout>
