---
import Layout from '@layouts/Layout.astro';
import { getAllPosts } from '@content/posts';

export async function getStaticPaths() {
  const pageSize = 10;
  const total = (await getAllPosts()).length;
  const pages = Math.max(1, Math.ceil(total / pageSize));
  return Array.from({ length: pages - 1 }, (_, i) => ({ params: { page: String(i + 2) } }));
}

const { page } = Astro.params;
const current = Number(page);
const pageSize = 10;
const allPosts = await getAllPosts();
const start = (current - 1) * pageSize;
const pagePosts = allPosts.slice(start, start + pageSize);
const pageCount = Math.ceil(allPosts.length / pageSize);
const title = `Blog – Page ${current}`;
const description = 'Articles and notes'
---

<Layout title={title} description={description}>
  <h1 class="text-2xl font-semibold">{title}</h1>

  <ul class="mt-6 space-y-4">
    {pagePosts.map(p => (
      <li>
        <a class="text-primary hover:underline" href={`/blog/${p.slug}`}>{p.title}</a>
        {p.date && <span class="ml-2 text-sm opacity-70">{new Date(p.date).toLocaleDateString()}</span>}
        {p.description && <p class="opacity-80">{p.description}</p>}
      </li>
    ))}
  </ul>

  <nav class="mt-8 flex gap-3 items-center">
    {current > 1 && <a class="border px-3 py-1 rounded-xl hover:bg-muted" href={current === 2 ? '/blog' : `/blog/page/${current - 1}`}>← Prev</a>}
    <span class="opacity-70">Page {current} of {pageCount}</span>
    {current < pageCount && <a class="border px-3 py-1 rounded-xl hover:bg-muted" href={`/blog/page/${current + 1}`}>Next →</a>}
  </nav>
</Layout>
